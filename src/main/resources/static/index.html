<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <meta charset="UTF-8">
    <title>Nightreign Quest Log</title>
    <!-- 
      To generate a suitable background, use a prompt like:
      "A dark fantasy landscape inspired by Elden Ring, with a mystical moon, ancient ruins, and ethereal night lighting, in the style of Nightreign, ultra high resolution, digital art"
      Save the image as 'elden_ring_nightreign_bg.jpg' in the static directory.
    -->
</head>
<body>
    <!-- Background Chant Audio -->
    <audio id="bg-chant" src="background_ambience.mp3" autoplay loop preload="auto"></audio>
    <script>
        // Lower the background chant volume for ambience
        window.addEventListener('DOMContentLoaded', () => {
            const chant = document.getElementById('bg-chant');
            if (chant) chant.volume = 0.25;
        });

        // Ensure audio plays after user interaction (required by browsers)
          window.addEventListener('click', function playChantOnce() {
            const chant = document.getElementById('bg-chant');
            if (chant && chant.paused) {
                chant.play().catch(() => {});
            }
            window.removeEventListener('click', playChantOnce);
        });
    </script>
    <div class="elden-header">
        <h1>ðŸŒ‘ Nightreign Quest Log</h1>
        <p class="subtitle">"May your will forge the fate of the Lands Between."</p>
    </div>
    <div id="todo-container">
        <form id="add-todo-form" autocomplete="off">
            <input type="text" id="new-todo-title" placeholder="Enter your next journey..." required>
            <button type="submit" title="Add quest">âœš</button>
        </form>
        <ul id="todo-list"></ul>
    </div>
    <audio id="complete-sound" src="elden_ring_complete.mp3" preload="auto"></audio>
    <script>
        function fetchTodos() {
            fetch('http://localhost:8080/todos')
                .then(response => response.json())
                .then(todos => {
                    const list = document.getElementById('todo-list');
                    list.innerHTML = '';
                    todos.forEach(todo => {
                        const li = document.createElement('li');
                        li.className = todo.status === 'DONE' ? 'completed' : '';
                        // Icon
                        const icon = document.createElement('span');
                        icon.className = 'todo-icon';
                        icon.textContent = todo.status === 'DONE' ? 'ðŸŒ•' : 'ðŸŒ‘';
                        li.appendChild(icon);

                        // Title
                        const span = document.createElement('span');
                        span.textContent = todo.title;
                        li.appendChild(span);

                        // Status selector
                        const select = document.createElement('select');
                        ['PENDING', 'DONE'].forEach(status => {
                            const option = document.createElement('option');
                            option.value = status;
                            option.text = status === 'DONE' ? 'Fulfilled' : 'Unfulfilled';
                            if (todo.status === status) option.selected = true;
                            select.appendChild(option);
                        });
                        select.onchange = () => updateTodoStatus(todo.id, todo.title, todo.status, select.value);
                        li.appendChild(select);

                        // Delete button
                        const btn = document.createElement('button');
                        btn.textContent = 'âœ–';
                        btn.title = 'Abandon quest';
                        btn.onclick = () => deleteTodo(todo.id);
                        li.appendChild(btn);

                        list.appendChild(li);
                    });
                });
        }

        function deleteTodo(id) {
            fetch(`http://localhost:8080/todos/${id}`, { method: 'DELETE' })
                .then(fetchTodos);
        }

        function updateTodoStatus(id, title, oldStatus, newStatus) {
            fetch(`http://localhost:8080/todos/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, status: newStatus })
            }).then(() => {
                if (oldStatus !== 'DONE' && newStatus === 'DONE') {
                    document.getElementById('complete-sound').play();
                }
                fetchTodos();
            });
        }

        document.getElementById('add-todo-form').onsubmit = function(e) {
            e.preventDefault();
            const title = document.getElementById('new-todo-title').value.trim();
            if (!title) return;
            fetch('http://localhost:8080/todos', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title })
            }).then(() => {
                document.getElementById('new-todo-title').value = '';
                fetchTodos();
            });
        };

        fetchTodos();
    </script>

    <div class="image-grid">
        <div class="image-placeholder">
            <img class="preview-img" src="preview_icon.png" alt="Preview" />
            <img src="elden_ring_nightreign_bg.jpg" alt="Image 1">
            <div class="eliminated-overlay">Eliminated</div>
        </div>
        <div class="image-placeholder">
            <img class="preview-img" src="preview_icon.png" alt="Preview" />
            <img src="elden_ring_nightreign_bg.jpg" alt="Image 2">
            <div class="eliminated-overlay">Eliminated</div>
        </div>
        <div class="image-placeholder">
            <img class="preview-img" src="preview_icon.png" alt="Preview" />
            <img src="elden_ring_nightreign_bg.jpg" alt="Image 3">
            <div class="eliminated-overlay">Eliminated</div>
        </div>
        <div class="image-placeholder">
            <img class="preview-img" src="preview_icon.png" alt="Preview" />
            <img src="elden_ring_nightreign_bg.jpg" alt="Image 4">
            <div class="eliminated-overlay">Eliminated</div>
        </div>
        <div class="image-placeholder">
            <img class="preview-img" src="preview_icon.png" alt="Preview" />
            <img src="elden_ring_nightreign_bg.jpg" alt="Image 5">
            <div class="eliminated-overlay">Eliminated</div>
        </div>
        <div class="image-placeholder">
            <img class="preview-img" src="preview_icon.png" alt="Preview" />
            <img src="elden_ring_nightreign_bg.jpg" alt="Image 6">
            <div class="eliminated-overlay">Eliminated</div>
        </div>
    </div>
    <script>
        // Toggle eliminated state on div or overlay, revert on second press
        document.querySelectorAll('.image-placeholder').forEach(placeholder => {
            placeholder.addEventListener('click', function(e) {
                // Only toggle if clicking the placeholder or its overlay
                if (
                    e.target === this ||
                    (e.target.classList && e.target.classList.contains('eliminated-overlay'))
                ) {
                    this.classList.toggle('eliminated');
                }
            });
        });
    </script>
</body>
</html>